import React, { useState, useEffect } from "react";
import {
  Container,
  Box,
  Typography,
  Button,
  Grid,
  Paper,
  Tabs,
  Tab,
  FormControl,
  InputLabel,
  Select,
  MenuItem,
  TextField,
  Alert,
  Accordion,
  AccordionSummary,
  AccordionDetails,
  Chip,
} from "@mui/material";
import ExpandMoreIcon from "@mui/icons-material/ExpandMore";
import FileInput from "../components/Fileinput";
import ComparisonResult from "../components/ComparisonResult";
import * as Diff from "diff";
import axios from "axios";
import { findMatchingProcessor } from "../data/paymentProcessors";

function Filecomp() {
  const [file1Content, setFile1Content] = useState("");
  const [textOrFileContent, setTextOrFileContent] = useState("");
  const [file1Name, setFile1Name] = useState("");
  const [file2Name, setFile2Name] = useState("");
  const [comparisonResult, setComparisonResult] = useState(null);
  const [filesIdentical, setFilesIdentical] = useState(null);
  const [inputMode, setInputMode] = useState("existing-file");
  const [url, setUrl] = useState("");
  // const [fileContent, setFileContent] = useState("");
  const [inputMethod, setInputMethod] = useState("paste"); // Default to paste text
  const [fileVersion, setFileVersion] = useState("sandbox"); // Default to sandbox version
  const [alternativeMatch, setAlternativeMatch] = useState(null); // For storing alternative payment processor matches

  // Pre-existing file content for Sandbox, Live, and Braintree versions
  const sandboxFileContent =
    "7B227073704964223A2241443631324543383841333039314132314539434132433035304439454130353741414535444341304542413237424243333838463239344231353534434233222C2276657273696F6E223A312C22637265617465644F6E223A313731353237313630333931352C227369676E6174757265223A223330383030363039326138363438383666373064303130373032613038303330383030323031303133313064333030623036303936303836343830313635303330343032303133303830303630393261383634383836663730643031303730313030303061303830333038323033653333303832303338386130303330323031303230323038313636333463386230653330353731373330306130363038326138363438636533643034303330323330376133313265333032633036303335353034303330633235343137303730366336353230343137303730366336393633363137343639366636653230343936653734363536373732363137343639366636653230343334313230326432303437333333313236333032343036303335353034306230633164343137303730366336353230343336353732373436393636363936333631373436393666366532303431373537343638366637323639373437393331313333303131303630333535303430613063306134313730373036633635323034393665363332653331306233303039303630333535303430363133303235353533333031653137306433323334333033343332333933313337333433373332333735613137306433323339333033343332333833313337333433373332333635613330356633313235333032333036303335353034303330633163363536333633326437333664373032643632373236663662363537323264373336393637366535663535343333343264353035323466343433313134333031323036303335353034306230633062363934663533323035333739373337343635366437333331313333303131303630333535303430613063306134313730373036633635323034393665363332653331306233303039303630333535303430363133303235353533333035393330313330363037326138363438636533643032303130363038326138363438636533643033303130373033343230303034633231353737656465626436633762323231386636386464373039306131323138646337623062643666326332383364383436303935643934616634613534313162383334323065643831316633343037653833333331663163353463336637656233323230643662616435643465666634393238393839336537633066313361333832303231313330383230323064333030633036303335353164313330313031666630343032333030303330316630363033353531643233303431383330313638303134323366323439633434663933653465663237653663346636323836633366613262626664326534623330343530363038326230363031303530353037303130313034333933303337333033353036303832623036303130353035303733303031383632393638373437343730336132663266366636333733373032653631373037303663363532653633366636643266366636333733373033303334326436313730373036633635363136393633363133333330333233303832303131643036303335353164323030343832303131343330383230313130333038323031306330363039326138363438383666373633363430353031333038316665333038316333303630383262303630313035303530373032303233303831623630633831623335323635366336393631366536333635323036663665323037343638363937333230363336353732373436393636363936333631373436353230363237393230363136653739323037303631373237343739323036313733373337353664363537333230363136333633363537303734363136653633363532303666363632303734363836353230373436383635366532303631373037303663363936333631363236633635323037333734363136653634363137323634323037343635373236643733323036313665363432303633366636653634363937343639366636653733323036663636323037353733363532633230363336353732373436393636363936333631373436353230373036663663363936333739323036313665363432303633363537323734363936363639363336313734363936663665323037303732363136333734363936333635323037333734363137343635366436353665373437333265333033363036303832623036303130353035303730323031313632613638373437343730336132663266373737373737326536313730373036633635326536333666366432663633363537323734363936363639363336313734363536313735373436383666373236393734373932663330333430363033353531643166303432643330326233303239613032376130323538363233363837343734373033613266326636333732366332653631373037303663363532653633366636643266363137303730366336353631363936333631333332653633373236633330316430363033353531643065303431363034313439343537646236666435373438313836383938393736326637653537383530376537396235383234333030653036303335353164306630313031666630343034303330323037383033303066303630393261383634383836663736333634303631643034303230353030333030613036303832613836343863653364303430333032303334393030333034363032323130306336663032336362323631346262333033383838613136323938336531613933663130353666353066613738636462396261346361323431636331346532356530323231303062653363643064666431363234376636343934343735333830653964343463323238613130383930613361316463373234623862346362383838393831386263333038323032656533303832303237356130303330323031303230323038343936643266626633613938646139373330306130363038326138363438636533643034303330323330363733313162333031393036303335353034303330633132343137303730366336353230353236663666373432303433343132303264323034373333333132363330323430363033353530343062306331643431373037303663363532303433363537323734363936363639363336313734363936663665323034313735373436383666373236393734373933313133333031313036303335353034306130633061343137303730366336353230343936653633326533313062333030393036303335353034303631333032353535333330316531373064333133343330333533303336333233333334333633333330356131373064333233393330333533303336333233333334333633333330356133303761333132653330326330363033353530343033306332353431373037303663363532303431373037303663363936333631373436393666366532303439366537343635363737323631373436393666366532303433343132303264323034373333333132363330323430363033353530343062306331643431373037303663363532303433363537323734363936363639363336313734363936663665323034313735373436383666373236393734373933313133333031313036303335353034306130633061343137303730366336353230343936653633326533313062333030393036303335353034303631333032353535333330353933303133303630373261383634386365336430323031303630383261383634386365336430333031303730333432303030346630313731313834313964373634383564353161356532353831303737366538383061326566646537626165346465303864666334623933653133333536643536363562333561653232643039373736306432323465376262613038666437363137636538386362373662623636373062656338653832393834666635343435613338316637333038316634333034363036303832623036303130353035303730313031303433613330333833303336303630383262303630313035303530373330303138363261363837343734373033613266326636663633373337303265363137303730366336353265363336663664326636663633373337303330333432643631373037303663363537323666366637343633363136373333333031643036303335353164306530343136303431343233663234396334346639336534656632376536633466363238366333666132626266643265346233303066303630333535316431333031303166663034303533303033303130316666333031663036303335353164323330343138333031363830313462626230646561313538333338383961613438613939646562656264656261666461636232346162333033373036303335353164316630343330333032653330326361303261613032383836323636383734373437303361326632663633373236633265363137303730366336353265363336663664326636313730373036633635373236663666373436333631363733333265363337323663333030653036303335353164306630313031666630343034303330323031303633303130303630613261383634383836663736333634303630323065303430323035303033303061303630383261383634386365336430343033303230333637303033303634303233303361636637323833353131363939623138366662333563333536636136326266663431376564643930663735346461323865626566313963383135653432623738396638393866373962353939663938643534313064386639646539633266653032333033323264643534343231623061333035373736633564663333383362393036376664313737633263323136643936346663363732363938323132366635346638376137643162393963623962303938393231363130363939306630393932316430303030333138323031383833303832303138343032303130313330383138363330376133313265333032633036303335353034303330633235343137303730366336353230343137303730366336393633363137343639366636653230343936653734363536373732363137343639366636653230343334313230326432303437333333313236333032343036303335353034306230633164343137303730366336353230343336353732373436393636363936333631373436393666366532303431373537343638366637323639373437393331313333303131303630333535303430613063306134313730373036633635323034393665363332653331306233303039303630333535303430363133303235353533303230383136363334633862306533303537313733303062303630393630383634383031363530333034303230316130383139333330313830363039326138363438383666373064303130393033333130623036303932613836343838366637306430313037303133303163303630393261383634383836663730643031303930353331306631373064333233343330333533303339333133363332333033303333356133303238303630393261383634383836663730643031303933343331316233303139333030623036303936303836343830313635303330343032303161313061303630383261383634386365336430343033303233303266303630393261383634383836663730643031303930343331323230343230633364366466616634636131326539643331666630363161636563303536613232653131386261333262633934346664323166336231373838363634646634363330306130363038326138363438636533643034303330323034343733303435303232313030633961346263306665316537366332356636343136303264306238313462363666643264376534623263636537343138633132343532313866356230353963363032323036623632373361383536363830633738313064303131333538666463383563633764303730656531393736333234316537356336636237353732326164303930303030303030303030303030227D";
  const liveFileContent =
    "7B227073704964223A2246354246304143324336314131413238313043373531453439333444414433384346393037313041303935303844314133453241383436314141363232414145222C2276657273696F6E223A312C22637265617465644F6E223A313731353230343037313232362C227369676E6174757265223A223330383030363039326138363438383666373064303130373032613038303330383030323031303133313064333030623036303936303836343830313635303330343032303133303830303630393261383634383836663730643031303730313030303061303830333038323033653333303832303338386130303330323031303230323038313636333463386230653330353731373330306130363038326138363438636533643034303330323330376133313265333032633036303335353034303330633235343137303730366336353230343137303730366336393633363137343639366636653230343936653734363536373732363137343639366636653230343334313230326432303437333333313236333032343036303335353034306230633164343137303730366336353230343336353732373436393636363936333631373436393666366532303431373537343638366637323639373437393331313333303131303630333535303430613063306134313730373036633635323034393665363332653331306233303039303630333535303430363133303235353533333031653137306433323334333033343332333933313337333433373332333735613137306433323339333033343332333833313337333433373332333635613330356633313235333032333036303335353034303330633163363536333633326437333664373032643632373236663662363537323264373336393637366535663535343333343264353035323466343433313134333031323036303335353034306230633062363934663533323035333739373337343635366437333331313333303131303630333535303430613063306134313730373036633635323034393665363332653331306233303039303630333535303430363133303235353533333035393330313330363037326138363438636533643032303130363038326138363438636533643033303130373033343230303034633231353737656465626436633762323231386636386464373039306131323138646337623062643666326332383364383436303935643934616634613534313162383334323065643831316633343037653833333331663163353463336637656233323230643662616435643465666634393238393839336537633066313361333832303231313330383230323064333030633036303335353164313330313031666630343032333030303330316630363033353531643233303431383330313638303134323366323439633434663933653465663237653663346636323836633366613262626664326534623330343530363038326230363031303530353037303130313034333933303337333033353036303832623036303130353035303733303031383632393638373437343730336132663266366636333733373032653631373037303663363532653633366636643266366636333733373033303334326436313730373036633635363136393633363133333330333233303832303131643036303335353164323030343832303131343330383230313130333038323031306330363039326138363438383666373633363430353031333038316665333038316333303630383262303630313035303530373032303233303831623630633831623335323635366336393631366536333635323036663665323037343638363937333230363336353732373436393636363936333631373436353230363237393230363136653739323037303631373237343739323036313733373337353664363537333230363136333633363537303734363136653633363532303666363632303734363836353230373436383635366532303631373037303663363936333631363236633635323037333734363136653634363137323634323037343635373236643733323036313665363432303633366636653634363937343639366636653733323036663636323037353733363532633230363336353732373436393636363936333631373436353230373036663663363936333739323036313665363432303633363537323734363936363639363336313734363936663665323037303732363136333734363936333635323037333734363137343635366436353665373437333265333033363036303832623036303130353035303730323031313632613638373437343730336132663266373737373737326536313730373036633635326536333666366432663633363537323734363936363639363336313734363536313735373436383666373236393734373932663330333430363033353531643166303432643330326233303239613032376130323538363233363837343734373033613266326636333732366332653631373037303663363532653633366636643266363137303730366336353631363936333631333332653633373236633330316430363033353531643065303431363034313439343537646236666435373438313836383938393736326637653537383530376537396235383234333030653036303335353164306630313031666630343034303330323037383033303066303630393261383634383836663736333634303631643034303230353030333030613036303832613836343863653364303430333032303334393030333034363032323130306336663032336362323631346262333033383838613136323938336531613933663130353666353066613738636462396261346361323431636331346532356530323231303062653363643064666431363234376636343934343735333830653964343463323238613130383930613361316463373234623862346362383838393831386263333038323032656533303832303237356130303330323031303230323038343936643266626633613938646139373330306130363038326138363438636533643034303330323330363733313162333031393036303335353034303330633132343137303730366336353230353236663666373432303433343132303264323034373333333132363330323430363033353530343062306331643431373037303663363532303433363537323734363936363639363336313734363936663665323034313735373436383666373236393734373933313133333031313036303335353034306130633061343137303730366336353230343936653633326533313062333030393036303335353034303631333032353535333330316531373064333133343330333533303336333233333334333633333330356131373064333233393330333533303336333233333334333633333330356133303761333132653330326330363033353530343033306332353431373037303663363532303431373037303663363936333631373436393666366532303439366537343635363737323631373436393666366532303433343132303264323034373333333132363330323430363033353530343062306331643431373037303663363532303433363537323734363936363639363336313734363936663665323034313735373436383666373236393734373933313133333031313036303335353034306130633061343137303730366336353230343936653633326533313062333030393036303335353034303631333032353535333330353933303133303630373261383634386365336430323031303630383261383634386365336430333031303730333432303030346630313731313834313964373634383564353161356532353831303737366538383061326566646537626165346465303864666334623933653133333536643536363562333561653232643039373736306432323465376262613038666437363137636538386362373662623636373062656338653832393834666635343435613338316637333038316634333034363036303832623036303130353035303730313031303433613330333833303336303630383262303630313035303530373330303138363261363837343734373033613266326636663633373337303265363137303730366336353265363336663664326636663633373337303330333432643631373037303663363537323666366637343633363136373333333031643036303335353164306530343136303431343233663234396334346639336534656632376536633466363238366333666132626266643265346233303066303630333535316431333031303166663034303533303033303130316666333031663036303335353164323330343138333031363830313462626230646561313538333338383961613438613939646562656264656261666461636232346162333033373036303335353164316630343330333032653330326361303261613032383836323636383734373437303361326632663633373236633265363137303730366336353265363336663664326636313730373036633635373236663666373436333631363733333265363337323663333030653036303335353164306630313031666630343034303330323031303633303130303630613261383634383836663736333634303630323065303430323035303033303061303630383261383634386365336430343033303230333637303033303634303233303361636637323833353131363939623138366662333563333536636136326266663431376564643930663735346461323865626566313963383135653432623738396638393866373962353939663938643534313064386639646539633266653032333033323264643534343231623061333035373736633564663333383362393036376664313737633263323136643936346663363732363938323132366635346638376137643162393963623962303938393231363130363939306630393932316430303030333138323031383833303832303138343032303130313330383138363330376133313265333032633036303335353034303330633235343137303730366336353230343137303730366336393633363137343639366636653230343936653734363536373732363137343639366636653230343334313230326432303437333333313236333032343036303335353034306230633164343137303730366336353230343336353732373436393636363936333631373436393666366532303431373537343638366637323639373437393331313333303131303630333535303430613063306134313730373036633635323034393665363332653331306233303039303630333535303430363133303235353533303230383136363334633862306533303537313733303062303630393630383634383031363530333034303230316130383139333330313830363039326138363438383666373064303130393033333130623036303932613836343838366637306430313037303133303163303630393261383634383836663730643031303930353331306631373064333233343330333533303338333233313333333433333331356133303238303630393261383634383836663730643031303933343331316233303139333030623036303936303836343830313635303330343032303161313061303630383261383634386365336430343033303233303266303630393261383634383836663730643031303930343331323230343230353936643939343335373738303366313137346361653066633761343164383634653964366266336535363638646164356563393334303937313439633762623330306130363038326138363438636533643034303330323034343733303435303232313030383565623363643837343731346466343461333830373838643439626537656630303630643765313236633966653638663261333336386363623233373363643032323035366535336363363330376433393561643465663532376234333531323462616636653761383537363030616463376135343561333862613039376139643734303030303030303030303030227D";
  const braintreeFileContent =
    "7B227073704964223A2232423234313930333341453639363537373934433435343939413636433631313838323237383038443330313135444346334132433533324342444342374342222C2276657273696F6E223A312C22637265617465644F6E223A313731353230333431323032362C227369676E6174757265223A2233303830303630393261383634383836663730643031303730326130383033303830303230313031333130643330306230363039363038363438303136353033303430323031333038303036303932613836343838366637306430313037303130303030613038303330383230336533333038323033383861303033303230313032303230383136363334633862306533303537313733303061303630383261383634386365336430343033303233303761333132653330326330363033353530343033306332353431373037303663363532303431373037303663363936333631373436393666366532303439366537343635363737323631373436393666366532303433343132303264323034373333333132363330323430363033353530343062306331643431373037303663363532303433363537323734363936363639363336313734363936663665323034313735373436383666373236393734373933313133333031313036303335353034306130633061343137303730366336353230343936653633326533313062333030393036303335353034303631333032353535333330316531373064333233343330333433323339333133373334333733323337356131373064333233393330333433323338333133373334333733323336356133303566333132353330323330363033353530343033306331633635363336333264373336643730326436323732366636623635373232643733363936373665356635353433333432643530353234663434333131343330313230363033353530343062306330623639346635333230353337393733373436353664373333313133333031313036303335353034306130633061343137303730366336353230343936653633326533313062333030393036303335353034303631333032353535333330353933303133303630373261383634386365336430323031303630383261383634386365336430333031303730333432303030346332313537376564656264366337623232313866363864643730393061313231386463376230626436663263323833643834363039356439346166346135343131623833343230656438313166333430376538333333316631633534633366376562333232306436626164356434656666343932383938393365376330663133613338323032313133303832303230643330306330363033353531643133303130316666303430323330303033303166303630333535316432333034313833303136383031343233663234396334346639336534656632376536633466363238366333666132626266643265346233303435303630383262303630313035303530373031303130343339333033373330333530363038326230363031303530353037333030313836323936383734373437303361326632663666363337333730326536313730373036633635326536333666366432663666363337333730333033343264363137303730366336353631363936333631333333303332333038323031316430363033353531643230303438323031313433303832303131303330383230313063303630393261383634383836663736333634303530313330383166653330383163333036303832623036303130353035303730323032333038316236306338316233353236353663363936313665363336353230366636653230373436383639373332303633363537323734363936363639363336313734363532303632373932303631366537393230373036313732373437393230363137333733373536643635373332303631363336333635373037343631366536333635323036663636323037343638363532303734363836353665323036313730373036633639363336313632366336353230373337343631366536343631373236343230373436353732366437333230363136653634323036333666366536343639373436393666366537333230366636363230373537333635326332303633363537323734363936363639363336313734363532303730366636633639363337393230363136653634323036333635373237343639363636393633363137343639366636653230373037323631363337343639363336353230373337343631373436353664363536653734373332653330333630363038326230363031303530353037303230313136326136383734373437303361326632663737373737373265363137303730366336353265363336663664326636333635373237343639363636393633363137343635363137353734363836663732363937343739326633303334303630333535316431663034326433303262333032396130323761303235383632333638373437343730336132663266363337323663326536313730373036633635326536333666366432663631373037303663363536313639363336313333326536333732366333303164303630333535316430653034313630343134393435376462366664353734383138363839383937363266376535373835303765373962353832343330306530363033353531643066303130316666303430343033303230373830333030663036303932613836343838366637363336343036316430343032303530303330306130363038326138363438636533643034303330323033343930303330343630323231303063366630323363623236313462623330333838386131363239383365316139336631303536663530666137386364623962613463613234316363313465323565303232313030626533636430646664313632343766363439343437353338306539643434633232386131303839306133613164633732346238623463623838383938313862633330383230326565333038323032373561303033303230313032303230383439366432666266336139386461393733303061303630383261383634386365336430343033303233303637333131623330313930363033353530343033306331323431373037303663363532303532366636663734323034333431323032643230343733333331323633303234303630333535303430623063316434313730373036633635323034333635373237343639363636393633363137343639366636653230343137353734363836663732363937343739333131333330313130363033353530343061306330613431373037303663363532303439366536333265333130623330303930363033353530343036313330323535353333303165313730643331333433303335333033363332333333343336333333303561313730643332333933303335333033363332333333343336333333303561333037613331326533303263303630333535303430333063323534313730373036633635323034313730373036633639363336313734363936663665323034393665373436353637373236313734363936663665323034333431323032643230343733333331323633303234303630333535303430623063316434313730373036633635323034333635373237343639363636393633363137343639366636653230343137353734363836663732363937343739333131333330313130363033353530343061306330613431373037303663363532303439366536333265333130623330303930363033353530343036313330323535353333303539333031333036303732613836343863653364303230313036303832613836343863653364303330313037303334323030303466303137313138343139643736343835643531613565323538313037373665383830613265666465376261653464653038646663346239336531333335366435363635623335616532326430393737363064323234653762626130386664373631376365383863623736626236363730626563386538323938346666353434356133383166373330383166343330343630363038326230363031303530353037303130313034336133303338333033363036303832623036303130353035303733303031383632613638373437343730336132663266366636333733373032653631373037303663363532653633366636643266366636333733373033303334326436313730373036633635373236663666373436333631363733333330316430363033353531643065303431363034313432336632343963343466393365346566323765366334663632383663336661326262666432653462333030663036303335353164313330313031666630343035333030333031303166663330316630363033353531643233303431383330313638303134626262306465613135383333383839616134386139396465626562646562616664616362323461623330333730363033353531643166303433303330326533303263613032616130323838363236363837343734373033613266326636333732366332653631373037303663363532653633366636643266363137303730366336353732366636663734363336313637333332653633373236633330306530363033353531643066303130316666303430343033303230313036333031303036306132613836343838366637363336343036303230653034303230353030333030613036303832613836343863653364303430333032303336373030333036343032333033616366373238333531313639396231383666623335633335366361363262666634313765646439306637353464613238656265663139633831356534326237383966383938663739623539396639386435343130643866396465396332666530323330333232646435343432316230613330353737366335646633333833623930363766643137376332633231366439363466633637323639383231323666353466383761376431623939636239623039383932313631303639393066303939323164303030303331383230313839333038323031383530323031303133303831383633303761333132653330326330363033353530343033306332353431373037303663363532303431373037303663363936333631373436393666366532303439366537343635363737323631373436393666366532303433343132303264323034373333333132363330323430363033353530343062306331643431373037303663363532303433363537323734363936363639363336313734363936663665323034313735373436383666373236393734373933313133333031313036303335353034306130633061343137303730366336353230343936653633326533313062333030393036303335353034303631333032353535333032303831363633346338623065333035373137333030623036303936303836343830313635303330343032303161303831393333303138303630393261383634383836663730643031303930333331306230363039326138363438383666373064303130373031333031633036303932613836343838366637306430313039303533313066313730643332333433303335333033383332333133323333333333323561333032383036303932613836343838366637306430313039333433313162333031393330306230363039363038363438303136353033303430323031613130613036303832613836343863653364303430333032333032663036303932613836343838366637306430313039303433313232303432306562653863663335376664326331366335323037376538396239626634303936303730313537383230346239643334373965393761653463393531376631653433303061303630383261383634386365336430343033303230343438333034363032323130306638646263336433636461333365393733396561376665623334633661616333396132323932383533656634636431373433663863656537353034383335633930323231303039336366313063353539376232303433343931663766353039303432643162353965303834383661653763666564396564386531643366333739343036356139303030303030303030303030227D"; // Use live PayPal content for now

  useEffect(() => {
    // Load the selected file version content when the component mounts or version changes
    if (fileVersion === "sandbox") {
      setFile1Content(sandboxFileContent);
    } else if (fileVersion === "live") {
      setFile1Content(liveFileContent);
    } else if (fileVersion === "braintree") {
      setFile1Content(braintreeFileContent);
    }
  }, [fileVersion, sandboxFileContent, liveFileContent, braintreeFileContent]);

  const handleUrlChange = (e) => {
    setUrl(e.target.value);
  };

  const fetchUrlContent = async () => {
    try {
      const response = await axios.get(
        `${url}/.well-known/apple-developer-merchantid-domain-association`
      );
      console.log("Fetched content from URL:", response.data);
      setTextOrFileContent(response.data);
      return response.data;
    } catch (error) {
      console.error("Failed to fetch content from URL:", error);
      return null;
    }
  };

  // const fetchUrlContent = async () => {
  //   const fullURL = `${url}/.well-known/apple-developer-merchantid-domain-association`; // Replace with your actual URL

  //   try {
  //     const response = await axios.get(
  //       `http://localhost:3333/fetch-url-content`,
  //       {
  //         params: { url: fullURL },
  //       }
  //     );
  //     console.log("Fetched content from server:", response.data);
  //     setTextOrFileContent(response.data);
  //   } catch (error) {
  //     console.error("Failed to fetch content from server:", error);
  //   }
  // };

  const handleTabChange = (event, newValue) => {
    setInputMode(newValue);
    // Clear alternative match when input mode changes
    setAlternativeMatch(null);
  };

  const handleInputMethodChange = (event) => {
    setInputMethod(event.target.value);
    // Clear alternative match when input method changes
    setAlternativeMatch(null);
  };

  const handleFileVersionChange = (event) => {
    setFileVersion(event.target.value);
    // Clear alternative match when version changes
    setAlternativeMatch(null);
  };

  const compareContent = () => {
    let diff;
    if (inputMode === "file-file") {
      diff = Diff.diffWords(file1Content, textOrFileContent);
    } else if (inputMode === "text-text") {
      diff = Diff.diffWords(file1Content, textOrFileContent);
    } else if (inputMode === "file-text") {
      diff = Diff.diffWords(file1Content, textOrFileContent);
    } else if (inputMode === "existing-file") {
      diff = Diff.diffWords(file1Content, textOrFileContent);
    }
    setComparisonResult(diff);

    const areContentsIdentical = diff.every(
      (part) => !part.added && !part.removed
    );
    setFilesIdentical(areContentsIdentical);

    // Only check alternative payment processors for live PayPal comparison
    if (
      inputMode === "existing-file" &&
      fileVersion === "live" &&
      !areContentsIdentical
    ) {
      const matchingProcessor = findMatchingProcessor(textOrFileContent);
      setAlternativeMatch(matchingProcessor);
    } else {
      setAlternativeMatch(null);
    }
  };

  return (
    <Container maxWidth="md">
      <Box my={4}>
        <Typography variant="h3" component="h1" gutterBottom align="center">
          Compare Tool
        </Typography>
        <Paper elevation={3} style={{ padding: "20px" }}>
          <Tabs
            value={inputMode}
            onChange={handleTabChange}
            variant="fullWidth">
            <Tab label="Compare with Existing File" value="existing-file" />
            <Tab label="File vs File" value="file-file" />
            <Tab label="Text vs Text" value="text-text" />
            <Tab label="File vs Text" value="file-text" />
          </Tabs>
          <Grid container spacing={3} mt={2}>
            {inputMode === "file-file" && (
              <>
                <Grid item xs={12} sm={6}>
                  <FileInput
                    setContent={setFile1Content}
                    label="File 1"
                    isTextInput={false}
                    setFileName={setFile1Name}
                    fileName={file1Name}
                  />
                </Grid>
                <Grid item xs={12} sm={6}>
                  <FileInput
                    setContent={setTextOrFileContent}
                    label="File 2"
                    isTextInput={false}
                    setFileName={setFile2Name}
                    fileName={file2Name}
                  />
                </Grid>
              </>
            )}
            {inputMode === "text-text" && (
              <>
                <Grid item xs={12} sm={6}>
                  <FileInput
                    setContent={setFile1Content}
                    label="Text 1"
                    isTextInput={true}
                  />
                </Grid>
                <Grid item xs={12} sm={6}>
                  <FileInput
                    setContent={setTextOrFileContent}
                    label="Text 2"
                    isTextInput={true}
                  />
                </Grid>
              </>
            )}
            {inputMode === "file-text" && (
              <>
                <Grid item xs={12} sm={6}>
                  <FileInput
                    setContent={setFile1Content}
                    label="File"
                    isTextInput={false}
                    setFileName={setFile1Name}
                    fileName={file1Name}
                  />
                </Grid>
                <Grid item xs={12} sm={6}>
                  <FileInput
                    setContent={setTextOrFileContent}
                    label="Text"
                    isTextInput={true}
                  />
                </Grid>
              </>
            )}
            {inputMode === "existing-file" && (
              <>
                <Grid item xs={12} sm={6}>
                  <FormControl fullWidth>
                    <InputLabel>File Version</InputLabel>
                    <Select
                      value={fileVersion}
                      onChange={handleFileVersionChange}
                      label="File Version">
                      <MenuItem value="sandbox">PayPal Sandbox</MenuItem>
                      <MenuItem value="live">PayPal Live</MenuItem>
                      <MenuItem value="braintree">Braintree Live</MenuItem>
                    </Select>
                  </FormControl>
                  <Typography variant="h6" mt={2}>
                    {fileVersion === "sandbox"
                      ? "PayPal Sandbox Apple Pay file"
                      : fileVersion === "live"
                      ? "PayPal Live Apple Pay file"
                      : "Braintree Live Apple Pay file"}
                  </Typography>
                </Grid>
                <Grid item xs={12} sm={6}>
                  <FormControl fullWidth>
                    <InputLabel>Input Method</InputLabel>
                    <Select
                      value={inputMethod}
                      onChange={handleInputMethodChange}
                      label="Input Method">
                      <MenuItem value="paste">Paste Text</MenuItem>
                      <MenuItem value="upload">Upload File</MenuItem>
                      <MenuItem value="url">Fetch from URL</MenuItem>
                    </Select>
                  </FormControl>
                  <Box mt={2}>
                    {inputMethod === "paste" ? (
                      <FileInput
                        setContent={setTextOrFileContent}
                        label="Paste Text to Compare"
                        isTextInput={true}
                      />
                    ) : inputMethod === "upload" ? (
                      <FileInput
                        setContent={setTextOrFileContent}
                        label="Upload File to Compare"
                        isTextInput={false}
                        setFileName={setFile2Name}
                        fileName={file2Name}
                      />
                    ) : (
                      <Box>
                        <TextField
                          fullWidth
                          label="Enter URL"
                          value={url}
                          onChange={handleUrlChange}
                        />
                        <Button
                          variant="contained"
                          color="primary"
                          onClick={fetchUrlContent}
                          sx={{ mt: 2 }}>
                          Fetch
                        </Button>
                      </Box>
                    )}
                  </Box>
                </Grid>
              </>
            )}
          </Grid>
          <Box mt={3} textAlign="center">
            <Button
              variant="contained"
              color="primary"
              onClick={compareContent}
              disabled={!textOrFileContent}>
              Compare
            </Button>
            <Typography variant="h4" mt={2}>
              When fetching from URL it will fail please add this chrome
              extension to allow CORS.{" "}
              <a
                style={{ color: "blue" }}
                target="_blank"
                href="https://chromewebstore.google.com/detail/allow-cors-access-control/lhobafahddgcelffkeicbaginigeejlf?hl=en"
                rel="noreferrer">
                CORS extension
              </a>
            </Typography>
          </Box>
        </Paper>
        {filesIdentical !== null && (
          <Box mt={4}>
            <Paper
              elevation={2}
              sx={{
                p: 3,
                backgroundColor: filesIdentical ? "#f1f8e9" : "#fff3e0",
              }}>
              {/* Main Result Header */}
              <Box textAlign="center" mb={3}>
                <Typography variant="h4" gutterBottom>
                  Comparison Result
                </Typography>

                {/* File Labels */}
                <Box
                  display="flex"
                  justifyContent="space-between"
                  alignItems="center"
                  mb={3}
                  sx={{ maxWidth: 600, mx: "auto" }}>
                  <Box textAlign="center" flex={1}>
                    <Chip
                      label={`${
                        fileVersion === "sandbox"
                          ? "PayPal Sandbox"
                          : fileVersion === "live"
                          ? "PayPal Live"
                          : "Braintree Live"
                      } File`}
                      color="primary"
                      variant="outlined"
                      sx={{ mb: 1 }}
                    />
                    <Typography variant="body2" color="text.secondary">
                      Reference File
                    </Typography>
                  </Box>

                  <Typography variant="h6" color="text.secondary" mx={2}>
                    vs
                  </Typography>

                  <Box textAlign="center" flex={1}>
                    <Chip
                      label="Your File"
                      color="secondary"
                      variant="outlined"
                      sx={{ mb: 1 }}
                    />
                    <Typography variant="body2" color="text.secondary">
                      {inputMethod === "paste"
                        ? "Pasted Content"
                        : inputMethod === "upload"
                        ? "Uploaded File"
                        : "Fetched from URL"}
                    </Typography>
                  </Box>
                </Box>

                {/* Match Result */}
                <Box
                  sx={{
                    p: 2,
                    borderRadius: 2,
                    backgroundColor: filesIdentical ? "#4caf50" : "#ff9800",
                    color: "white",
                    mb: 2,
                  }}>
                  <Typography variant="h5" fontWeight="bold">
                    {filesIdentical ? "✓ FILES MATCH" : "✗ FILES DO NOT MATCH"}
                  </Typography>
                  <Typography variant="body1" mt={1}>
                    {filesIdentical
                      ? `Your file is identical to ${
                          fileVersion === "sandbox"
                            ? "PayPal's sandbox"
                            : fileVersion === "live"
                            ? "PayPal's live"
                            : "Braintree's live"
                        } domain association file`
                      : `Your file differs from ${
                          fileVersion === "sandbox"
                            ? "PayPal's sandbox"
                            : fileVersion === "live"
                            ? "PayPal's live"
                            : "Braintree's live"
                        } domain association file`}
                  </Typography>
                </Box>
              </Box>

              {/* Alternative Payment Processor Match */}
              {inputMode === "existing-file" &&
                fileVersion === "live" &&
                !filesIdentical && (
                  <Box mb={3}>
                    {alternativeMatch ? (
                      <Alert severity="info" sx={{ maxWidth: 600, mx: "auto" }}>
                        <Typography variant="body1">
                          <strong>Alternative Match Found:</strong> Your file
                          appears to match <strong>{alternativeMatch}</strong>'s
                          domain association file.
                        </Typography>
                      </Alert>
                    ) : (
                      <Alert
                        severity="warning"
                        sx={{ maxWidth: 600, mx: "auto" }}>
                        <Typography variant="body1">
                          <strong>No Alternative Match:</strong> Your file
                          doesn't match any known payment processor's domain
                          association file in our database.
                        </Typography>
                      </Alert>
                    )}
                  </Box>
                )}

              {/* Detailed Comparison (Collapsible) */}
              {!filesIdentical && comparisonResult && (
                <Box sx={{ maxWidth: 800, mx: "auto" }}>
                  <Accordion>
                    <AccordionSummary
                      expandIcon={<ExpandMoreIcon />}
                      aria-controls="detailed-comparison-content"
                      id="detailed-comparison-header">
                      <Typography variant="h6">
                        View Detailed Differences
                      </Typography>
                    </AccordionSummary>
                    <AccordionDetails>
                      <Typography variant="body2" color="text.secondary" mb={2}>
                        Green text shows additions in your file, red text shows
                        what's missing compared to PayPal's file.
                      </Typography>
                      <ComparisonResult result={comparisonResult} />
                    </AccordionDetails>
                  </Accordion>
                </Box>
              )}
            </Paper>
          </Box>
        )}

        {/* Remove the old comparison result display */}
        {comparisonResult && filesIdentical && (
          <Box mt={2} textAlign="center">
            <Typography variant="body2" color="text.secondary">
              Files are identical - no differences to display
            </Typography>
          </Box>
        )}
      </Box>
    </Container>
  );
}

export default Filecomp;
